# Инструкция по настройке областей доставки

## Как работает ограничение областей доставки

### 1. ISO коды регионов России

Система использует **ISO 3166-2** коды регионов России для определения границ областей доставки.

**Формат:** `RU-XXX` где:
- `RU` - код страны (Россия)
- `XXX` - код региона (3 буквы)

**Примеры:**
- `RU-MOS` - Московская область
- `RU-MOW` - Москва (город федерального значения)
- `RU-SAM` - Самарская область
- `RU-SPE` - Санкт-Петербург
- `RU-KDA` - Краснодарский край
- `RU-NVS` - Новосибирская область
- `RU-YAR` - Ярославская область

### 2. Где найти ISO коды регионов

**Официальные источники:**

1. **Википедия:**
   - https://ru.wikipedia.org/wiki/ISO_3166-2:RU
   - Полный список всех регионов России с ISO кодами

2. **Официальный стандарт ISO 3166-2:**
   - https://www.iso.org/obp/ui/#iso:code:3166:RU
   - Официальная база данных ISO

3. **Документация Яндекс.Карт:**
   - При использовании `ymaps.borders.load()` можно найти ISO коды в свойствах загруженных регионов
   - Свойство: `properties.iso3166`

### 3. Как добавить новый регион доставки

В файле `src/components/YandexMap.jsx`:

**Шаг 1:** Добавить ISO код региона в массив `allowedRegionCodes` (строка 15):
```javascript
const allowedRegionCodes = ['RU-MOS', 'RU-MOW', 'RU-SAM', 'RU-XXX'];
```

**Шаг 2:** Добавить названия региона в массив `allowedRegionNames` (строки 126-129):
```javascript
const allowedRegionNames = [
  'Московская область', 'Москва', 'Москва г',
  'Самарская область', 'Самара',
  'Название области', 'Название города'  // добавить сюда
];
```

**Шаг 3:** Добавить проверку названия в условие (строки 135-142 и 149-156):
```javascript
(name.includes('Название области') && compName.includes('Название области')) ||
(name.includes('Название города') && compName.includes('Название города'))
```

### 4. Как работает система

1. **Загрузка границ регионов:**
   - Система загружает границы всех регионов России через `ymaps.borders.load('RU')`
   - Фильтрует по ISO кодам из `allowedRegionCodes`
   - Отображает границы разрешенных регионов зеленым полигоном на карте

2. **Проверка при клике:**
   - При клике на карту получаются координаты точки
   - Выполняется геокодирование через API Яндекс.Карт
   - Из ответа геокодера извлекается название региона
   - Проверяется, входит ли регион в список разрешенных (`allowedRegionNames`)
   - Если регион не разрешен - показывается предупреждение и метка удаляется

3. **Структура ответа геокодера:**
   - Компоненты адреса находятся в: `metaDataProperty.GeocoderMetaData.Address.Components`
   - Регион имеет `kind`: `administrative_area_level_1` или `province`
   - Название региона в поле `name`

### 5. Примеры ISO кодов популярных регионов

| Регион | ISO код |
|--------|---------|
| Московская область | RU-MOS |
| Москва | RU-MOW |
| Санкт-Петербург | RU-SPE |
| Ленинградская область | RU-LEN |
| Самарская область | RU-SAM |
| Краснодарский край | RU-KDA |
| Новосибирская область | RU-NVS |
| Свердловская область | RU-SVE |
| Ростовская область | RU-ROS |
| Республика Татарстан | RU-TA |
| Нижегородская область | RU-NIZ |
| Челябинская область | RU-CHE |

### 6. Для настройки через админку

**Рекомендуемая структура данных:**

```json
{
  "delivery_regions": [
    {
      "iso_code": "RU-MOS",
      "names": ["Московская область"],
      "enabled": true
    },
    {
      "iso_code": "RU-MOW",
      "names": ["Москва", "Москва г"],
      "enabled": true
    },
    {
      "iso_code": "RU-SAM",
      "names": ["Самарская область", "Самара"],
      "enabled": true
    }
  ]
}
```

**В компоненте карты:**
- Читать список разрешенных регионов из пропсов или из конфига
- Использовать `iso_code` для загрузки границ
- Использовать `names` для проверки названия региона из геокодирования

### 7. Важные замечания

1. **Названия регионов могут отличаться:**
   - "Московская область" может приходить как "Московская обл."
   - "Москва" может приходить как "Москва г" или "г. Москва"
   - Поэтому проверка использует `includes()` для частичного совпадения

2. **ISO коды должны быть точными:**
   - Коды из стандарта ISO 3166-2:RU
   - Проверяйте на официальных источниках

3. **Границы загружаются автоматически:**
   - Не нужно передавать координаты границ вручную
   - Яндекс.Карты загружают готовые границы по ISO кодам

